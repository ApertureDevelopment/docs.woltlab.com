<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" ">
<title>Part 2: Event Listeners and Template Listeners | WoltLab Suite 5.3 Documentation</title>

<link rel="stylesheet" href="https://docs.woltlab.com/5.3/css/syntax.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600">
<link rel="stylesheet" href="https://docs.woltlab.com/5.3/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="https://docs.woltlab.com/5.3/css/modern-business.css">
<link rel="stylesheet" href="https://docs.woltlab.com/5.3/css/lavish-bootstrap.css">
<link rel="stylesheet" href="https://docs.woltlab.com/5.3/css/customstyles.css">
<link rel="stylesheet" href="https://docs.woltlab.com/5.3/css/theme-blue.css?v=3">

<script src="https://docs.woltlab.com/5.3/js/jquery.min.js"></script>
<script src="https://docs.woltlab.com/5.3/js/jquery.cookie.min.js"></script>
<script src="https://docs.woltlab.com/5.3/js/jquery.navgoco.min.js"></script>
<script src="https://docs.woltlab.com/5.3/js/bootstrap.min.js"></script>
<script src="https://docs.woltlab.com/5.3/js/anchor.min.js"></script>
<script src="https://docs.woltlab.com/5.3/js/toc.js"></script>
<script src="https://docs.woltlab.com/5.3/js/customscripts.js"></script>

<link rel="shortcut icon" href="https://docs.woltlab.com/5.3/images/favicon.ico">

<link rel="alternate" type="application/rss+xml" title="docs.woltlab.com" href="https://docs.woltlab.com/5.3feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
  <!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> WoltLab Suite 5.3 Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="https://www.woltlab.com" target="_blank">woltlab.com</a></li>
                
                
                
                
                
                <li><a href="https://github.com/WoltLab/WCF/" target="_blank">Code on github.com</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="https://docs.woltlab.com/5.3/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'https://docs.woltlab.com/5.3/search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Part 2: Event Listeners and Template Listeners">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>


  <div class="container">
    <div class="col-lg-12">&nbsp;</div>

    <div class="row">
      <div class="col-md-3">
        


<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">WoltLab Suite 5.3</li>

    
        
            <li>
                <a href="#">Getting Started</a>
                <ul>
                    
                        
                            
                            
                                <li data-identifier="index"><a href="index.html">Introduction</a></li>
                            
                        

                        
                    
                        
                            
                            
                                <li data-identifier="getting-started_quick-start"><a href="getting-started_quick-start.html">Quick Start</a></li>
                            
                        

                        
                    
                </ul>
            </li>
        
            <li>
                <a href="#">PHP API</a>
                <ul>
                    
                        
                            
                            
                                <li data-identifier="php_pages"><a href="php_pages.html">Pages</a></li>
                            
                        

                        
                    
                        
                            
                            
                                <li data-identifier="php_database-objects"><a href="php_database-objects.html">Database Objects</a></li>
                            
                        

                        
                    
                        
                            
                            
                                <li data-identifier="php_database-access"><a href="php_database-access.html">Database Access</a></li>
                            
                        

                        
                    
                        
                            
                            
                                <li data-identifier="php_exceptions"><a href="php_exceptions.html">Exceptions</a></li>
                            
                        

                        
                    
                        

                        
                            <li class="subfolders">
                                <a href="#">API</a>
                                <ul>
                                    
                                        
                                        
                                            <li data-identifier="php_api_caches"><a href="php_api_caches.html">Caches</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="php_api_comments"><a href="php_api_comments.html">Comments</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="php_api_cronjobs"><a href="php_api_cronjobs.html">Cronjobs</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="php_api_events"><a href="php_api_events.html">Events</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="php_api_form_builder"><a href="php_api_form_builder.html">Form Builder</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="php_api_package_installation_plugins"><a href="php_api_package_installation_plugins.html">Package Installation Plugins</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="php_api_user_activity_points"><a href="php_api_user_activity_points.html">User Activity Points</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="php_api_user_notifications"><a href="php_api_user_notifications.html">User Notifications</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="php_api_sitemaps"><a href="php_api_sitemaps.html">Sitemaps</a></li>
                                        
                                    
                                </ul>
                            </li>
                        
                    
                        
                            
                            
                                <li data-identifier="php_code-style"><a href="php_code-style.html">Code Style</a></li>
                            
                        

                        
                    
                        
                            
                            
                                <li data-identifier="php_apps"><a href="php_apps.html">Apps</a></li>
                            
                        

                        
                    
                        
                            
                            
                                <li data-identifier="php_gdpr"><a href="php_gdpr.html">GDPR</a></li>
                            
                        

                        
                    
                </ul>
            </li>
        
            <li>
                <a href="#">Languages, Templates & CSS</a>
                <ul>
                    
                        
                            
                            
                                <li data-identifier="view_languages"><a href="view_languages.html">Languages</a></li>
                            
                        

                        
                    
                        
                            
                            
                                <li data-identifier="view_templates"><a href="view_templates.html">Templates</a></li>
                            
                        

                        
                    
                        
                            
                            
                                <li data-identifier="view_css"><a href="view_css.html">CSS</a></li>
                            
                        

                        
                    
                </ul>
            </li>
        
            <li>
                <a href="#">JavaScript API</a>
                <ul>
                    
                        
                            
                            
                                <li data-identifier="javascript_general-usage"><a href="javascript_general-usage.html">General Usage</a></li>
                            
                        

                        
                    
                        

                        
                            <li class="subfolders">
                                <a href="#">New API</a>
                                <ul>
                                    
                                        
                                        
                                            <li data-identifier="javascript_new-api_writing-a-module"><a href="javascript_new-api_writing-a-module.html">Writing a module</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="javascript_new-api_data-structures"><a href="javascript_new-api_data-structures.html">Data Structures</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="javascript_new-api_core"><a href="javascript_new-api_core.html">Core Functions</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="javascript_new-api_dom"><a href="javascript_new-api_dom.html">DOM</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="javascript_new-api_events"><a href="javascript_new-api_events.html">Event Handling</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="javascript_new-api_ajax"><a href="javascript_new-api_ajax.html">Ajax</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="javascript_new-api_dialogs"><a href="javascript_new-api_dialogs.html">Dialogs</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="javascript_new-api_browser"><a href="javascript_new-api_browser.html">Browser and Screen Sizes</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="javascript_new-api_ui"><a href="javascript_new-api_ui.html">User Interface</a></li>
                                        
                                    
                                </ul>
                            </li>
                        
                    
                        
                            
                            
                                <li data-identifier="javascript_legacy-api"><a href="javascript_legacy-api.html">Legacy API</a></li>
                            
                        

                        
                    
                        
                            
                            
                                <li data-identifier="javascript_helper-functions"><a href="javascript_helper-functions.html">Helper Functions</a></li>
                            
                        

                        
                    
                        
                            
                            
                                <li data-identifier="javascript_code-snippets"><a href="javascript_code-snippets.html">Code Snippets</a></li>
                            
                        

                        
                    
                </ul>
            </li>
        
            <li>
                <a href="#">Package Components</a>
                <ul>
                    
                        
                            
                            
                                <li data-identifier="package_package-xml"><a href="package_package-xml.html">package.xml</a></li>
                            
                        

                        
                    
                        
                            
                            
                                <li data-identifier="package_pip"><a href="package_pip.html">PIPs</a></li>
                            
                        

                        
                    
                </ul>
            </li>
        
            <li>
                <a href="#">Migration</a>
                <ul>
                    
                        

                        
                            <li class="subfolders">
                                <a href="#">Migrating from WSC 5.2</a>
                                <ul>
                                    
                                        
                                        
                                            <li data-identifier="migration_wsc-52_php"><a href="migration_wsc-52_php.html">PHP API</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="migration_wsc-52_templates"><a href="migration_wsc-52_templates.html">Templates and Languages</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="migration_wsc-52_libraries"><a href="migration_wsc-52_libraries.html">Third Party Libraries</a></li>
                                        
                                    
                                </ul>
                            </li>
                        
                            <li class="subfolders">
                                <a href="#">Migrating from WSC 3.1</a>
                                <ul>
                                    
                                        
                                        
                                            <li data-identifier="migration_wsc-31_php"><a href="migration_wsc-31_php.html">PHP API</a></li>
                                        
                                    
                                </ul>
                            </li>
                        
                            <li class="subfolders">
                                <a href="#">Migrating from WSC 3.0</a>
                                <ul>
                                    
                                        
                                        
                                            <li data-identifier="migration_wsc-30_php"><a href="migration_wsc-30_php.html">PHP API</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="migration_wsc-30_javascript"><a href="migration_wsc-30_javascript.html">JavaScript API</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="migration_wsc-30_templates"><a href="migration_wsc-30_templates.html">Templates</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="migration_wsc-30_css"><a href="migration_wsc-30_css.html">CSS</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="migration_wsc-30_package"><a href="migration_wsc-30_package.html">Package Components</a></li>
                                        
                                    
                                </ul>
                            </li>
                        
                            <li class="subfolders">
                                <a href="#">Migrating from WCF 2.1</a>
                                <ul>
                                    
                                        
                                        
                                            <li data-identifier="migration_wcf-21_php"><a href="migration_wcf-21_php.html">PHP API</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="migration_wcf-21_templates"><a href="migration_wcf-21_templates.html">Templates</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="migration_wcf-21_css"><a href="migration_wcf-21_css.html">CSS</a></li>
                                        
                                    
                                        
                                        
                                            <li data-identifier="migration_wcf-21_package"><a href="migration_wcf-21_package.html">Package Components</a></li>
                                        
                                    
                                </ul>
                            </li>
                        
                    
                </ul>
            </li>
        
            <li>
                <a href="#">Tutorials</a>
                <ul>
                    
                        
                            
                            
                                <li data-identifier="tutorial_tutorial-series"><a href="tutorial_tutorial-series.html">Tutorial Series</a></li>
                            
                        

                        
                    
                </ul>
            </li>
        
    
</ul>

<script>
(function() {
    var sidebar = $('#mysidebar');
    var item = sidebar.find('.active');
    if (item.length === 0) {
        var parent = 'tutorial_tutorial-series';
        if (parent) {
            sidebar.find('li[data-identifier="' + parent + '"]').addClass('active');
        }
    }

    sidebar.find(".active").parents('li').toggleClass("active");
})();
</script>

      </div>

      <div class="col-md-9">
        <div class="bs-callout bs-callout-info">This version of the documentation for WoltLab Suite 5.3 is outdated. Please refer to <a href="https://docs.woltlab.com/latest/">the latest version</a>.</div>

        <div class="post-header">
   <h1 class="post-title-main">Part 2: Event Listeners and Template Listeners</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    
    
  <p>In the <a href="tutorial_tutorial-series_part-1-base-structure.html">first part</a> of this tutorial series, we have created the base structure of our people management package.
In further parts, we will use the package of the first part as a basis to directly add new features.
In order to explain how event listeners and template works, however, we will not directly adding a new feature to the package by altering it in this part, but we will assume that somebody else created the package and that we want to extend it the “correct” way by creating a plugin.</p>

<p>The goal of the small plugin that will be created in this part is to add the birthday of the managed people.
As in the first part, we will not bother with careful validation of the entered date but just make sure that it is a valid date.</p>

<h2 id="package-functionality">Package Functionality</h2>

<p>The package should provide the following possibilities/functions:</p>

<ul>
  <li>List person’s birthday (if set) in people list in the ACP</li>
  <li>Sort people list by birthday in the ACP</li>
  <li>Add or remove birthday when adding or editing person</li>
  <li>List person’s birthday (if set) in people list in the front end</li>
  <li>Sort people list by birthday in the front end</li>
</ul>

<h2 id="used-components">Used Components</h2>

<p>We will use the following package installation plugins:</p>

<ul>
  <li><a href="package_pip_acp-template.html">acpTemplate package installation plugin</a>,</li>
  <li><a href="package_pip_event-listener.html">eventListener package installation plugin</a>,</li>
  <li><a href="package_pip_file.html">file package installation plugin</a>,</li>
  <li><a href="package_pip_language.html">language package installation plugin</a>,</li>
  <li><a href="package_pip_sql.html">sql package installation plugin</a>,</li>
  <li><a href="package_pip_template.html">template package installation plugin</a>,</li>
  <li><a href="package_pip_template-listener.html">templateListener package installation plugin</a>.</li>
</ul>

<p>For more information about the event system, please refer to the <a href="php_api_events.html">dedicated page on events</a>.</p>

<h2 id="package-structure">Package Structure</h2>

<p>The package will have the following file structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>├── acptemplates
│   └── __personAddBirthday.tpl
├── eventListener.xml
├── files
│   └── lib
│       └── system
│           └── event
│               └── listener
│                   ├── BirthdayPersonAddFormListener.class.php
│                   └── BirthdaySortFieldPersonListPageListener.class.php
├── install.sql
├── language
│   ├── de.xml
│   └── en.xml
├── package.xml
├── templateListener.xml
└── templates
    ├── __personListBirthday.tpl
    └── __personListBirthdaySortField.tpl
</code></pre></div></div>

<h2 id="extending-person-model-installsql">Extending Person Model (<code class="language-plaintext highlighter-rouge">install.sql</code>)</h2>

<p>The existing model of a person only contains the person’s first name and their last name (in additional to the id used to identify created people).
To add the birthday to the model, we need to create an additional database table column using the <a href="package_pip_sql.html">sql package installation plugin</a>:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">wcf1_person</span> <span class="k">ADD</span> <span class="n">birthday</span> <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span></code></pre></figure>

<p>If we have a <a href="tutorial_tutorial-series_part-1-base-structure.html#person">Person object</a>, this new property can be accessed the same way as the <code class="language-plaintext highlighter-rouge">personID</code> property, the <code class="language-plaintext highlighter-rouge">firstName</code> property, or the <code class="language-plaintext highlighter-rouge">lastName</code> property from the base package: <code class="language-plaintext highlighter-rouge">$person-&gt;birthday</code>.</p>

<h2 id="setting-birthday-in-acp">Setting Birthday in ACP</h2>

<p>To set the birthday of a person, we need to extend the <code class="language-plaintext highlighter-rouge">personAdd</code> template to add an additional birthday field.
This can be achieved using the <code class="language-plaintext highlighter-rouge">dataFields</code> template event at whose position we inject the following template code:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="o">&lt;</span><span class="n">dl</span><span class="err">{</span><span class="n">if</span> <span class="err">$</span><span class="n">errorField</span> <span class="o">==</span> <span class="s1">'birthday'</span><span class="err">}</span> <span class="k">class</span><span class="o">=</span><span class="nv">"formError"</span><span class="err">{</span><span class="o">/</span><span class="n">if</span><span class="err">}</span><span class="o">&gt;</span>
	<span class="o">&lt;</span><span class="n">dt</span><span class="o">&gt;&lt;</span><span class="n">label</span> <span class="k">for</span><span class="o">=</span><span class="nv">"birthday"</span><span class="o">&gt;</span><span class="err">{</span><span class="n">lang</span><span class="err">}</span><span class="n">wcf</span><span class="p">.</span><span class="n">person</span><span class="p">.</span><span class="n">birthday</span><span class="err">{</span><span class="o">/</span><span class="n">lang</span><span class="err">}</span><span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;&lt;/</span><span class="n">dt</span><span class="o">&gt;</span>
	<span class="o">&lt;</span><span class="n">dd</span><span class="o">&gt;</span>
		<span class="o">&lt;</span><span class="k">input</span> <span class="k">type</span><span class="o">=</span><span class="nv">"date"</span> <span class="n">id</span><span class="o">=</span><span class="nv">"birthday"</span> <span class="n">name</span><span class="o">=</span><span class="nv">"birthday"</span> <span class="n">value</span><span class="o">=</span><span class="nv">"{$birthday}"</span><span class="o">&gt;</span>
		<span class="err">{</span><span class="n">if</span> <span class="err">$</span><span class="n">errorField</span> <span class="o">==</span> <span class="s1">'birthday'</span><span class="err">}</span>
			<span class="o">&lt;</span><span class="n">small</span> <span class="k">class</span><span class="o">=</span><span class="nv">"innerError"</span><span class="o">&gt;</span>
				<span class="err">{</span><span class="n">if</span> <span class="err">$</span><span class="n">errorType</span> <span class="o">==</span> <span class="s1">'noValidSelection'</span><span class="err">}</span>
					<span class="err">{</span><span class="n">lang</span><span class="err">}</span><span class="n">wcf</span><span class="p">.</span><span class="k">global</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="n">noValidSelection</span><span class="err">{</span><span class="o">/</span><span class="n">lang</span><span class="err">}</span>
				<span class="err">{</span><span class="k">else</span><span class="err">}</span>
					<span class="err">{</span><span class="n">lang</span><span class="err">}</span><span class="n">wcf</span><span class="p">.</span><span class="n">acp</span><span class="p">.</span><span class="n">person</span><span class="p">.</span><span class="n">birthday</span><span class="p">.</span><span class="n">error</span><span class="p">.</span><span class="err">{$</span><span class="n">errorType</span><span class="err">}{</span><span class="o">/</span><span class="n">lang</span><span class="err">}</span>
				<span class="err">{</span><span class="o">/</span><span class="n">if</span><span class="err">}</span>
			<span class="o">&lt;/</span><span class="n">small</span><span class="o">&gt;</span>
		<span class="err">{</span><span class="o">/</span><span class="n">if</span><span class="err">}</span>
	<span class="o">&lt;/</span><span class="n">dd</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">dl</span><span class="o">&gt;</span></code></pre></figure>

<p>which we store in a <code class="language-plaintext highlighter-rouge">__personAddBirthday.tpl</code> template file.
The used language item <code class="language-plaintext highlighter-rouge">wcf.person.birthday</code> is actually the only new one for this package:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="o">&lt;?</span><span class="n">xml</span> <span class="k">version</span><span class="o">=</span><span class="nv">"1.0"</span> <span class="k">encoding</span><span class="o">=</span><span class="nv">"UTF-8"</span><span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="k">language</span> <span class="n">xmlns</span><span class="o">=</span><span class="nv">"http://www.woltlab.com"</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">xsi</span><span class="o">=</span><span class="nv">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="n">xsi</span><span class="p">:</span><span class="n">schemaLocation</span><span class="o">=</span><span class="nv">"http://www.woltlab.com http://www.woltlab.com/XSD/tornado/language.xsd"</span> <span class="n">languagecode</span><span class="o">=</span><span class="nv">"de"</span><span class="o">&gt;</span>
	<span class="o">&lt;</span><span class="n">category</span> <span class="n">name</span><span class="o">=</span><span class="nv">"wcf.person"</span><span class="o">&gt;</span>
		<span class="o">&lt;</span><span class="n">item</span> <span class="n">name</span><span class="o">=</span><span class="nv">"wcf.person.birthday"</span><span class="o">&gt;&lt;!</span><span class="p">[</span><span class="n">CDATA</span><span class="p">[</span><span class="n">Geburtstag</span><span class="p">]]</span><span class="o">&gt;&lt;/</span><span class="n">item</span><span class="o">&gt;</span>
	<span class="o">&lt;/</span><span class="n">category</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="k">language</span><span class="o">&gt;</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="o">&lt;?</span><span class="n">xml</span> <span class="k">version</span><span class="o">=</span><span class="nv">"1.0"</span> <span class="k">encoding</span><span class="o">=</span><span class="nv">"UTF-8"</span><span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="k">language</span> <span class="n">xmlns</span><span class="o">=</span><span class="nv">"http://www.woltlab.com"</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">xsi</span><span class="o">=</span><span class="nv">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="n">xsi</span><span class="p">:</span><span class="n">schemaLocation</span><span class="o">=</span><span class="nv">"http://www.woltlab.com http://www.woltlab.com/XSD/tornado/language.xsd"</span> <span class="n">languagecode</span><span class="o">=</span><span class="nv">"en"</span><span class="o">&gt;</span>
	<span class="o">&lt;</span><span class="n">category</span> <span class="n">name</span><span class="o">=</span><span class="nv">"wcf.person"</span><span class="o">&gt;</span>
		<span class="o">&lt;</span><span class="n">item</span> <span class="n">name</span><span class="o">=</span><span class="nv">"wcf.person.birthday"</span><span class="o">&gt;&lt;!</span><span class="p">[</span><span class="n">CDATA</span><span class="p">[</span><span class="n">Birthday</span><span class="p">]]</span><span class="o">&gt;&lt;/</span><span class="n">item</span><span class="o">&gt;</span>
	<span class="o">&lt;/</span><span class="n">category</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="k">language</span><span class="o">&gt;</span></code></pre></figure>

<p>The template listener needs to be registered using the <a href="package_pip_template-listener.html">templateListener package installation plugin</a>.
The corresponding complete <code class="language-plaintext highlighter-rouge">templateListener.xml</code> file is included <a href="#templatelistenerxml">below</a>.</p>

<p>The template code alone is not sufficient because the <code class="language-plaintext highlighter-rouge">birthday</code> field is, at the moment, neither read, nor processed, nor saved by any PHP code.
This can be be achieved, however, by adding event listeners to <code class="language-plaintext highlighter-rouge">PersonAddForm</code> and <code class="language-plaintext highlighter-rouge">PersonEditForm</code> which allow us to execute further code at specific location of the program.
Before we take a look at the event listener code, we need to identify exactly which additional steps we need to undertake:</p>

<ol>
  <li>If a person is edited and the form has not been submitted, the existing birthday of that person needs to be read.</li>
  <li>If a person is added or edited and the form has been submitted, the new birthday value needs to be read.</li>
  <li>If a person is added or edited and the form has been submitted, the new birthday value needs to be validated.</li>
  <li>If a person is added or edited and the new birthday value has been successfully validated, the new birthday value needs to be saved.</li>
  <li>If a person is added and the new birthday value has been successfully saved, the internally stored birthday needs to be reset so that the birthday field is empty when the form is shown again.</li>
  <li>The internally stored birthday value needs to be assigned to the template.</li>
</ol>

<p>The following event listeners achieves these requirements:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">wcf\system\event\listener</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">wcf\acp\form\PersonAddForm</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">wcf\acp\form\PersonEditForm</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">wcf\form\IForm</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">wcf\page\IPage</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">wcf\system\exception\UserInputException</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">wcf\system\WCF</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">wcf\util\StringUtil</span><span class="p">;</span>

<span class="cd">/**
 * Handles setting the birthday when adding and editing people.
 *
 * @author	Matthias Schmidt
 * @copyright	2001-2020 WoltLab GmbH
 * @license	GNU Lesser General Public License &lt;http://opensource.org/licenses/lgpl-license.php&gt;
 * @package	WoltLabSuite\Core\System\Event\Listener
 */</span>
<span class="kd">class</span> <span class="nc">BirthdayPersonAddFormListener</span> <span class="k">extends</span> <span class="nx">AbstractEventListener</span> <span class="p">{</span>
	<span class="cd">/**
	 * birthday of the created or edited person
	 * @var	string
	 */</span>
	<span class="k">protected</span> <span class="nv">$birthday</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
	
	<span class="cd">/**
	 * @see	IPage::assignVariables()
	 */</span>
	<span class="k">protected</span> <span class="k">function</span> <span class="nf">onAssignVariables</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">WCF</span><span class="o">::</span><span class="na">getTPL</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">assign</span><span class="p">(</span><span class="s1">'birthday'</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">birthday</span><span class="p">);</span>
	<span class="p">}</span>
	
	<span class="cd">/**
	 * @see	IPage::readData()
	 */</span>
	<span class="k">protected</span> <span class="k">function</span> <span class="nf">onReadData</span><span class="p">(</span><span class="nx">PersonEditForm</span> <span class="nv">$form</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">))</span> <span class="p">{</span>
			<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">birthday</span> <span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">person</span><span class="o">-&gt;</span><span class="na">birthday</span><span class="p">;</span>
			
			<span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">birthday</span> <span class="o">===</span> <span class="s1">'0000-00-00'</span><span class="p">)</span> <span class="p">{</span>
				<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">birthday</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	
	<span class="cd">/**
	 * @see	IForm::readFormParameters()
	 */</span>
	<span class="k">protected</span> <span class="k">function</span> <span class="nf">onReadFormParameters</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'birthday'</span><span class="p">]))</span> <span class="p">{</span>
			<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">birthday</span> <span class="o">=</span> <span class="nx">StringUtil</span><span class="o">::</span><span class="na">trim</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'birthday'</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	
	<span class="cd">/**
	 * @see	IForm::save()
	 */</span>
	<span class="k">protected</span> <span class="k">function</span> <span class="nf">onSave</span><span class="p">(</span><span class="nx">PersonAddForm</span> <span class="nv">$form</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">birthday</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$form</span><span class="o">-&gt;</span><span class="na">additionalFields</span><span class="p">[</span><span class="s1">'birthday'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">birthday</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="nv">$form</span><span class="o">-&gt;</span><span class="na">additionalFields</span><span class="p">[</span><span class="s1">'birthday'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'0000-00-00'</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	
	<span class="cd">/**
	 * @see	IForm::saved()
	 */</span>
	<span class="k">protected</span> <span class="k">function</span> <span class="nf">onSaved</span><span class="p">()</span> <span class="p">{</span>
		<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">birthday</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="cd">/**
	 * @see	IForm::validate()
	 */</span>
	<span class="k">protected</span> <span class="k">function</span> <span class="nf">onValidate</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">birthday</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/^(\d{4})-(\d{2})-(\d{2})$/'</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">birthday</span><span class="p">,</span> <span class="nv">$match</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nx">UserInputException</span><span class="p">(</span><span class="s1">'birthday'</span><span class="p">,</span> <span class="s1">'noValidSelection'</span><span class="p">);</span>
		<span class="p">}</span>
		
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">checkdate</span><span class="p">(</span><span class="nb">intval</span><span class="p">(</span><span class="nv">$match</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$match</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$match</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span> <span class="p">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nx">UserInputException</span><span class="p">(</span><span class="s1">'birthday'</span><span class="p">,</span> <span class="s1">'noValidSelection'</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Some notes on the code:</p>

<ul>
  <li>We are inheriting from <code class="language-plaintext highlighter-rouge">AbstractEventListener</code>, instead of just implementing the <code class="language-plaintext highlighter-rouge">IParameterizedEventListener</code> interface.
The <code class="language-plaintext highlighter-rouge">execute()</code> method of <code class="language-plaintext highlighter-rouge">AbstractEventListener</code> contains a dispatcher that automatically calls methods called <code class="language-plaintext highlighter-rouge">on</code> followed by the event name with the first character uppercased, passing the event object and the <code class="language-plaintext highlighter-rouge">$parameters</code> array.
This simple pattern results in the event <code class="language-plaintext highlighter-rouge">foo</code> being forwarded to the method <code class="language-plaintext highlighter-rouge">onFoo($eventObj, $parameters)</code>.</li>
  <li>The <code class="language-plaintext highlighter-rouge">birthday</code> column has a default value of <code class="language-plaintext highlighter-rouge">0000-00-00</code>, which we interpret as “birthday not set”.
To show an empty input field in this case, we empty the <code class="language-plaintext highlighter-rouge">birthday</code> property after reading such a value in <code class="language-plaintext highlighter-rouge">readData()</code>.</li>
  <li>The validation of the date is, as mentioned before, very basic and just checks the form of the string and uses PHP’s <a href="https://secure.php.net/manual/en/function.checkdate.php">checkdate</a> function to validate the components.</li>
  <li>The <code class="language-plaintext highlighter-rouge">save</code> needs to make sure that the passed date is actually a valid date and set it to <code class="language-plaintext highlighter-rouge">0000-00-00</code> if no birthday is given.
To actually save the birthday in the database, we do not directly manipulate the database but can add an additional field to the data array passed to <code class="language-plaintext highlighter-rouge">PersonAction::create()</code> via <code class="language-plaintext highlighter-rouge">AbstractForm::$additionalFields</code>.
As the <code class="language-plaintext highlighter-rouge">save</code> event is the last event fired before the actual save process happens, this is the perfect event to set this array element.</li>
</ul>

<p>The event listeners are installed using the <code class="language-plaintext highlighter-rouge">eventListener.xml</code> file shown <a href="#eventlistenerxml">below</a>.</p>

<h2 id="adding-birthday-table-column-in-acp">Adding Birthday Table Column in ACP</h2>

<p>To add a birthday column to the person list page in the ACP, we need three parts:</p>

<ol>
  <li>an event listener that makes the <code class="language-plaintext highlighter-rouge">birthday</code> database table column a valid sort field,</li>
  <li>a template listener that adds the birthday column to the table’s head, and</li>
  <li>a template listener that adds the birthday column to the table’s rows.</li>
</ol>

<p>The first part is a very simple class:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">wcf\system\event\listener</span><span class="p">;</span>
<span class="kn">use</span> <span class="nn">wcf\page\SortablePage</span><span class="p">;</span>

<span class="cd">/**
 * Makes people's birthday a valid sort field in the ACP and the front end.
 * 
 * @author	Matthias Schmidt
 * @copyright	2001-2019 WoltLab GmbH
 * @license	GNU Lesser General Public License &lt;http://opensource.org/licenses/lgpl-license.php&gt;
 * @package	WoltLabSuite\Core\System\Event\Listener
 */</span>
<span class="kd">class</span> <span class="nc">BirthdaySortFieldPersonListPageListener</span> <span class="k">implements</span> <span class="nx">IParameterizedEventListener</span> <span class="p">{</span>
	<span class="cd">/**
	 * @inheritDoc
	 */</span>
	<span class="k">public</span> <span class="k">function</span> <span class="nf">execute</span><span class="p">(</span><span class="nv">$eventObj</span><span class="p">,</span> <span class="nv">$className</span><span class="p">,</span> <span class="nv">$eventName</span><span class="p">,</span> <span class="k">array</span> <span class="o">&amp;</span><span class="nv">$parameters</span><span class="p">)</span> <span class="p">{</span>
		<span class="cd">/** @var SortablePage $eventObj */</span>
		
		<span class="nv">$eventObj</span><span class="o">-&gt;</span><span class="na">validSortFields</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'birthday'</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<div class="bs-callout bs-callout-info">We use <code class="language-plaintext highlighter-rouge">SortablePage</code> as a type hint instead of <code class="language-plaintext highlighter-rouge">wcf\acp\page\PersonListPage</code> because we will be using the same event listener class in the front end to also allow sorting that list by birthday.</div>

<p>As the relevant template codes are only one line each, we will simply put them directly in the <code class="language-plaintext highlighter-rouge">templateListener.xml</code> file that will be shown <a href="#templatelistenerxml">later on</a>.
The code for the table head is similar to the other <code class="language-plaintext highlighter-rouge">th</code> elements:</p>

<div class="language-smarty highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;th</span> <span class="na">class=</span><span class="s">"columnDate columnBirthday</span><span class="k">{</span><span class="nb">if</span> <span class="nv">$sortField</span> <span class="o">==</span> <span class="s1">'birthday'</span><span class="k">}</span><span class="s"> active {@$sortOrder}</span><span class="k">{/</span><span class="nb">if</span><span class="k">}</span><span class="s">"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="k">{</span><span class="na">link</span> <span class="na">controller</span><span class="o">=</span><span class="s1">'PersonList'</span><span class="k">}</span><span class="s">pageNo={@$pageNo}&amp;sortField=birthday&amp;sortOrder=</span><span class="k">{</span><span class="nb">if</span> <span class="nv">$sortField</span> <span class="o">==</span> <span class="s1">'birthday'</span> <span class="o">&amp;&amp;</span> <span class="nv">$sortOrder</span> <span class="o">==</span> <span class="s1">'ASC'</span><span class="k">}</span><span class="s">DESC</span><span class="k">{</span><span class="nb">else</span><span class="k">}</span><span class="s">ASC</span><span class="k">{/</span><span class="nb">if</span><span class="k">}{/</span><span class="na">link</span><span class="k">}</span><span class="s">"</span><span class="nt">&gt;</span><span class="k">{</span><span class="na">lang</span><span class="k">}</span>wcf.person.birthday<span class="k">{/</span><span class="na">lang</span><span class="k">}</span><span class="nt">&lt;/a&gt;&lt;/th&gt;</span>
</code></pre></div></div>

<p>For the table body’s column, we need to make sure that the birthday is only show if it is actually set:</p>

<div class="language-smarty highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"columnDate columnBirthday"</span><span class="nt">&gt;</span><span class="k">{</span><span class="nb">if</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">birthday</span> <span class="o">!==</span> <span class="s1">'0000-00-00'</span><span class="k">}{</span><span class="o">@</span><span class="nv">$person</span><span class="o">-&gt;</span><span class="na">birthday</span><span class="o">|</span><span class="na">strtotime</span><span class="o">|</span><span class="na">date</span><span class="k">}{/</span><span class="nb">if</span><span class="k">}</span><span class="nt">&lt;/td&gt;</span>
</code></pre></div></div>

<h2 id="adding-birthday-in-front-end">Adding Birthday in Front End</h2>

<p>In the front end, we also want to make the list sortable by birthday and show the birthday as part of each person’s “statistics”.</p>

<p>To add the birthday as a valid sort field, we use <code class="language-plaintext highlighter-rouge">BirthdaySortFieldPersonListPageListener</code> just as in the ACP.
In the front end, we will now use a template (<code class="language-plaintext highlighter-rouge">__personListBirthdaySortField.tpl</code>) instead of a directly putting the template code in the <code class="language-plaintext highlighter-rouge">templateListener.xml</code> file:</p>

<figure class="highlight"><pre><code class="language-smarty" data-lang="smarty"><span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"birthday"</span><span class="k">{</span><span class="nb">if</span> <span class="nv">$sortField</span> <span class="o">==</span> <span class="s1">'birthday'</span><span class="k">}</span> <span class="na">selected</span><span class="k">{/</span><span class="nb">if</span><span class="k">}</span><span class="nt">&gt;</span><span class="k">{</span><span class="na">lang</span><span class="k">}</span>wcf.person.birthday<span class="k">{/</span><span class="na">lang</span><span class="k">}</span><span class="nt">&lt;/option&gt;</span></code></pre></figure>

<div class="bs-callout bs-callout-info">You might have noticed the two underscores at the beginning of the template file. For templates that are included via template listeners, this is the naming convention we use.</div>

<p>Putting the template code into a file has the advantage that in the administrator is able to edit the code directly via a custom template group, even though in this case this might not be very probable.</p>

<p>To show the birthday, we use the following template code for the <code class="language-plaintext highlighter-rouge">personStatistics</code> template event, which again makes sure that the birthday is only shown if it is actually set:</p>

<figure class="highlight"><pre><code class="language-smarty" data-lang="smarty"><span class="k">{</span><span class="nb">if</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">birthday</span> <span class="o">!==</span> <span class="s1">'0000-00-00'</span><span class="k">}</span>
	<span class="nt">&lt;dt&gt;</span><span class="k">{</span><span class="na">lang</span><span class="k">}</span>wcf.person.birthday<span class="k">{/</span><span class="na">lang</span><span class="k">}</span><span class="nt">&lt;/dt&gt;</span>
	<span class="nt">&lt;dd&gt;</span>{@$person-&gt;birthday|strtotime|date}<span class="nt">&lt;/dd&gt;</span>
<span class="k">{/</span><span class="nb">if</span><span class="k">}</span></code></pre></figure>

<h2 id="templatelistenerxml"><code class="language-plaintext highlighter-rouge">templateListener.xml</code></h2>

<p>The following code shows the <code class="language-plaintext highlighter-rouge">templateListener.xml</code> file used to install all mentioned template listeners:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;data</span> <span class="na">xmlns=</span><span class="s">"http://www.woltlab.com"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.woltlab.com http://www.woltlab.com/tornado/XSD/templateListener.xsd"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;import&gt;</span>
		<span class="c">&lt;!-- admin --&gt;</span>
		<span class="nt">&lt;templatelistener</span> <span class="na">name=</span><span class="s">"personListBirthdayColumnHead"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;eventname&gt;</span>columnHeads<span class="nt">&lt;/eventname&gt;</span>
			<span class="nt">&lt;environment&gt;</span>admin<span class="nt">&lt;/environment&gt;</span>
			<span class="nt">&lt;templatecode&gt;</span><span class="cp">&lt;![CDATA[&lt;th class="columnDate columnBirthday{if $sortField == 'birthday'} active {@$sortOrder}{/if}"&gt;&lt;a href="{link controller='PersonList'}pageNo={@$pageNo}&amp;sortField=birthday&amp;sortOrder={if $sortField == 'birthday' &amp;&amp; $sortOrder == 'ASC'}DESC{else}ASC{/if}{/link}"&gt;{lang}wcf.person.birthday{/lang}&lt;/a&gt;&lt;/th&gt;]]&gt;</span><span class="nt">&lt;/templatecode&gt;</span>
			<span class="nt">&lt;templatename&gt;</span>personList<span class="nt">&lt;/templatename&gt;</span>
		<span class="nt">&lt;/templatelistener&gt;</span>
		<span class="nt">&lt;templatelistener</span> <span class="na">name=</span><span class="s">"personListBirthdayColumn"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;eventname&gt;</span>columns<span class="nt">&lt;/eventname&gt;</span>
			<span class="nt">&lt;environment&gt;</span>admin<span class="nt">&lt;/environment&gt;</span>
			<span class="nt">&lt;templatecode&gt;</span><span class="cp">&lt;![CDATA[&lt;td class="columnDate columnBirthday"&gt;{if $person-&gt;birthday !== '0000-00-00'}{@$person-&gt;birthday|strtotime|date}{/if}&lt;/td&gt;]]&gt;</span><span class="nt">&lt;/templatecode&gt;</span>
			<span class="nt">&lt;templatename&gt;</span>personList<span class="nt">&lt;/templatename&gt;</span>
		<span class="nt">&lt;/templatelistener&gt;</span>
		<span class="nt">&lt;templatelistener</span> <span class="na">name=</span><span class="s">"personAddBirthday"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;eventname&gt;</span>dataFields<span class="nt">&lt;/eventname&gt;</span>
			<span class="nt">&lt;environment&gt;</span>admin<span class="nt">&lt;/environment&gt;</span>
			<span class="nt">&lt;templatecode&gt;</span><span class="cp">&lt;![CDATA[{include file='__personAddBirthday'}]]&gt;</span><span class="nt">&lt;/templatecode&gt;</span>
			<span class="nt">&lt;templatename&gt;</span>personAdd<span class="nt">&lt;/templatename&gt;</span>
		<span class="nt">&lt;/templatelistener&gt;</span>
		<span class="c">&lt;!-- /admin --&gt;</span>
		
		<span class="c">&lt;!-- user --&gt;</span>
		<span class="nt">&lt;templatelistener</span> <span class="na">name=</span><span class="s">"personListBirthday"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;eventname&gt;</span>personStatistics<span class="nt">&lt;/eventname&gt;</span>
			<span class="nt">&lt;environment&gt;</span>user<span class="nt">&lt;/environment&gt;</span>
			<span class="nt">&lt;templatecode&gt;</span><span class="cp">&lt;![CDATA[{include file='__personListBirthday'}]]&gt;</span><span class="nt">&lt;/templatecode&gt;</span>
			<span class="nt">&lt;templatename&gt;</span>personList<span class="nt">&lt;/templatename&gt;</span>
		<span class="nt">&lt;/templatelistener&gt;</span>
		<span class="nt">&lt;templatelistener</span> <span class="na">name=</span><span class="s">"personListBirthdaySortField"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;eventname&gt;</span>sortField<span class="nt">&lt;/eventname&gt;</span>
			<span class="nt">&lt;environment&gt;</span>user<span class="nt">&lt;/environment&gt;</span>
			<span class="nt">&lt;templatecode&gt;</span><span class="cp">&lt;![CDATA[{include file='__personListBirthdaySortField'}]]&gt;</span><span class="nt">&lt;/templatecode&gt;</span>
			<span class="nt">&lt;templatename&gt;</span>personList<span class="nt">&lt;/templatename&gt;</span>
		<span class="nt">&lt;/templatelistener&gt;</span>
		<span class="c">&lt;!-- /user --&gt;</span>
	<span class="nt">&lt;/import&gt;</span>
<span class="nt">&lt;/data&gt;</span></code></pre></figure>

<p>In cases where a template is used, we simply use the <code class="language-plaintext highlighter-rouge">include</code> syntax to load the template.</p>

<h2 id="eventlistenerxml"><code class="language-plaintext highlighter-rouge">eventListener.xml</code></h2>

<p>There are two event listeners, <code class="language-plaintext highlighter-rouge">birthdaySortFieldAdminPersonList</code> and <code class="language-plaintext highlighter-rouge">birthdaySortFieldPersonList</code>, that make <code class="language-plaintext highlighter-rouge">birthday</code> a valid sort field in the ACP and the front end, respectively, and the rest takes care of setting the birthday.
The event listener <code class="language-plaintext highlighter-rouge">birthdayPersonAddFormInherited</code> takes care of the events that are relevant for both adding and editing people, thus it listens to the <code class="language-plaintext highlighter-rouge">PersonAddForm</code> class but has <code class="language-plaintext highlighter-rouge">inherit</code> set to <code class="language-plaintext highlighter-rouge">1</code> so that it also listens to the events of the <code class="language-plaintext highlighter-rouge">PersonEditForm</code> class.
In contrast, reading the existing birthday from a person is only relevant for editing so that the event listener <code class="language-plaintext highlighter-rouge">birthdayPersonEditForm</code> only listens to that class.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;data</span> <span class="na">xmlns=</span><span class="s">"http://www.woltlab.com"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.woltlab.com http://www.woltlab.com/XSD/tornado/eventListener.xsd"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;import&gt;</span>
		<span class="c">&lt;!-- admin --&gt;</span>
		<span class="nt">&lt;eventlistener</span> <span class="na">name=</span><span class="s">"birthdaySortFieldAdminPersonList"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;environment&gt;</span>admin<span class="nt">&lt;/environment&gt;</span>
			<span class="nt">&lt;eventclassname&gt;</span>wcf\acp\page\PersonListPage<span class="nt">&lt;/eventclassname&gt;</span>
			<span class="nt">&lt;eventname&gt;</span>validateSortField<span class="nt">&lt;/eventname&gt;</span>
			<span class="nt">&lt;listenerclassname&gt;</span>wcf\system\event\listener\BirthdaySortFieldPersonListPageListener<span class="nt">&lt;/listenerclassname&gt;</span>
		<span class="nt">&lt;/eventlistener&gt;</span>
		<span class="nt">&lt;eventlistener</span> <span class="na">name=</span><span class="s">"birthdayPersonAddForm"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;environment&gt;</span>admin<span class="nt">&lt;/environment&gt;</span>
			<span class="nt">&lt;eventclassname&gt;</span>wcf\acp\form\PersonAddForm<span class="nt">&lt;/eventclassname&gt;</span>
			<span class="nt">&lt;eventname&gt;</span>saved<span class="nt">&lt;/eventname&gt;</span>
			<span class="nt">&lt;listenerclassname&gt;</span>wcf\system\event\listener\BirthdayPersonAddFormListener<span class="nt">&lt;/listenerclassname&gt;</span>
		<span class="nt">&lt;/eventlistener&gt;</span>
		<span class="nt">&lt;eventlistener</span> <span class="na">name=</span><span class="s">"birthdayPersonAddFormInherited"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;environment&gt;</span>admin<span class="nt">&lt;/environment&gt;</span>
			<span class="nt">&lt;eventclassname&gt;</span>wcf\acp\form\PersonAddForm<span class="nt">&lt;/eventclassname&gt;</span>
			<span class="nt">&lt;eventname&gt;</span>assignVariables,readFormParameters,save,validate<span class="nt">&lt;/eventname&gt;</span>
			<span class="nt">&lt;listenerclassname&gt;</span>wcf\system\event\listener\BirthdayPersonAddFormListener<span class="nt">&lt;/listenerclassname&gt;</span>
			<span class="nt">&lt;inherit&gt;</span>1<span class="nt">&lt;/inherit&gt;</span>
		<span class="nt">&lt;/eventlistener&gt;</span>
		<span class="nt">&lt;eventlistener</span> <span class="na">name=</span><span class="s">"birthdayPersonEditForm"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;environment&gt;</span>admin<span class="nt">&lt;/environment&gt;</span>
			<span class="nt">&lt;eventclassname&gt;</span>wcf\acp\form\PersonEditForm<span class="nt">&lt;/eventclassname&gt;</span>
			<span class="nt">&lt;eventname&gt;</span>readData<span class="nt">&lt;/eventname&gt;</span>
			<span class="nt">&lt;listenerclassname&gt;</span>wcf\system\event\listener\BirthdayPersonAddFormListener<span class="nt">&lt;/listenerclassname&gt;</span>
		<span class="nt">&lt;/eventlistener&gt;</span>
		<span class="c">&lt;!-- /admin --&gt;</span>
		
		<span class="c">&lt;!-- user --&gt;</span>
		<span class="nt">&lt;eventlistener</span> <span class="na">name=</span><span class="s">"birthdaySortFieldPersonList"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;environment&gt;</span>user<span class="nt">&lt;/environment&gt;</span>
			<span class="nt">&lt;eventclassname&gt;</span>wcf\page\PersonListPage<span class="nt">&lt;/eventclassname&gt;</span>
			<span class="nt">&lt;eventname&gt;</span>validateSortField<span class="nt">&lt;/eventname&gt;</span>
			<span class="nt">&lt;listenerclassname&gt;</span>wcf\system\event\listener\BirthdaySortFieldPersonListPageListener<span class="nt">&lt;/listenerclassname&gt;</span>
		<span class="nt">&lt;/eventlistener&gt;</span>
		<span class="c">&lt;!-- /user --&gt;</span>
	<span class="nt">&lt;/import&gt;</span>
<span class="nt">&lt;/data&gt;</span></code></pre></figure>

<h2 id="packagexml"><code class="language-plaintext highlighter-rouge">package.xml</code></h2>

<p>The only relevant difference between the <code class="language-plaintext highlighter-rouge">package.xml</code> file of the base page from part 1 and the <code class="language-plaintext highlighter-rouge">package.xml</code> file of this package is that this package requires the base package <code class="language-plaintext highlighter-rouge">com.woltlab.wcf.people</code> (see <code class="language-plaintext highlighter-rouge">&lt;requiredpackages&gt;</code>):</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">"com.woltlab.wcf.people.birthday"</span> <span class="na">xmlns=</span><span class="s">"http://www.woltlab.com"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.woltlab.com http://www.woltlab.com/XSD/tornado/package.xsd"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;packageinformation&gt;</span>
		<span class="nt">&lt;packagename&gt;</span>WoltLab Suite Core Tutorial: People (Birthday)<span class="nt">&lt;/packagename&gt;</span>
		<span class="nt">&lt;packagedescription&gt;</span>Adds a birthday field to the people management system as part of a tutorial to create packages.<span class="nt">&lt;/packagedescription&gt;</span>
		<span class="nt">&lt;version&gt;</span>3.1.0<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;date&gt;</span>2018-03-30<span class="nt">&lt;/date&gt;</span>
	<span class="nt">&lt;/packageinformation&gt;</span>
	
	<span class="nt">&lt;authorinformation&gt;</span>
		<span class="nt">&lt;author&gt;</span>WoltLab GmbH<span class="nt">&lt;/author&gt;</span>
		<span class="nt">&lt;authorurl&gt;</span>http://www.woltlab.com<span class="nt">&lt;/authorurl&gt;</span>
	<span class="nt">&lt;/authorinformation&gt;</span>
	
	<span class="nt">&lt;requiredpackages&gt;</span>
		<span class="nt">&lt;requiredpackage</span> <span class="na">minversion=</span><span class="s">"3.1.0"</span><span class="nt">&gt;</span>com.woltlab.wcf<span class="nt">&lt;/requiredpackage&gt;</span>
		<span class="nt">&lt;requiredpackage</span> <span class="na">minversion=</span><span class="s">"3.1.0"</span><span class="nt">&gt;</span>com.woltlab.wcf.people<span class="nt">&lt;/requiredpackage&gt;</span>
	<span class="nt">&lt;/requiredpackages&gt;</span>
	
	<span class="nt">&lt;excludedpackages&gt;</span>
		<span class="nt">&lt;excludedpackage</span> <span class="na">version=</span><span class="s">"3.2.0 Alpha 1"</span><span class="nt">&gt;</span>com.woltlab.wcf<span class="nt">&lt;/excludedpackage&gt;</span>
	<span class="nt">&lt;/excludedpackages&gt;</span>
	
	<span class="nt">&lt;compatibility&gt;</span>
		<span class="nt">&lt;api</span> <span class="na">version=</span><span class="s">"2018"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/compatibility&gt;</span>
	
	<span class="nt">&lt;instructions</span> <span class="na">type=</span><span class="s">"install"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;instruction</span> <span class="na">type=</span><span class="s">"acpTemplate"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;instruction</span> <span class="na">type=</span><span class="s">"file"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;instruction</span> <span class="na">type=</span><span class="s">"sql"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;instruction</span> <span class="na">type=</span><span class="s">"template"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;instruction</span> <span class="na">type=</span><span class="s">"language"</span> <span class="nt">/&gt;</span>
		
		<span class="nt">&lt;instruction</span> <span class="na">type=</span><span class="s">"eventListener"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;instruction</span> <span class="na">type=</span><span class="s">"templateListener"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/instructions&gt;</span>
<span class="nt">&lt;/package&gt;</span></code></pre></figure>

<hr />

<p>This concludes the second part of our tutorial series after which you now have extended the base package using event listeners and template listeners that allow you to enter the birthday of the people.</p>

<p>The complete source code of this part can be found on <a href="https://github.com/WoltLab/woltlab.github.io/tree/master/_includes/tutorial/tutorial-series/part-2">GitHub</a>.</p>


    <div class="tags">
        
    </div>

    

</div>

      </div>
    </div>
  </div>

  <div class="footerBox">
    <div class="container">
      <div class="footerBoxLeft">
        
        <a target="_blank" href="https://github.com/woltlab/woltlab.github.io/blob/master/pages/tutorial/tutorial-series/tutorial_tutorial-series_part-2-event-listeners-and-template-listeners.md" class="btn btn-default githubEditButton no_icon" role="button"><i class="fa fa-github fa-lg"></i> Edit on GitHub</a>
        <p>Site last generated: Jul 9, 2021</p>
      </div>
      <div class="footerBoxRight">
        <a class="no_icon" href="https://www.woltlab.com"><img src="https://docs.woltlab.com/5.3/images/woltlab-black.png" srcset="https://docs.woltlab.com/5.3/images/woltlab-black@2x.png 2x" height="40" width="204" alt=""></a>
      </div>
    </div>
  </div>

  <div class="pageFooter">
    <div class="container">
      &copy; 2001 ‐ 2021 <a class="no_icon" href="https://www.woltlab.com">WoltLab GmbH</a>. All rights reserved. | <a class="no_icon" href="https://www.woltlab.com/legal-notice/">Legal Notice</a> | <a class="no_icon" href="https://www.woltlab.com/privacy-policy/">Privacy Policy</a>
    </div>
  </div>
</body>

</html>
